
import 'package:hacker_news/src/article.dart';
import 'package:test/test.dart';
import 'package:http/http.dart' as http;


void main(){
  test("parses topstories.json", (){
    const String jsonString = '[18378332,18377763,18379578,18375398,18379513,18378648,18375126,18375280,18374938,18378328,18378177,18374880,18378997,18379245,18376376,18376688,18379568,18378065,18377219,18378036,18372953,18373681,18376842,18379943,18375409,18372056,18375417,18376652,18376323,18379450,18374305,18378955,18378474,18376741,18376349,18377705,18378221,18375533,18377676,18376070,18374359,18379050,18378203,18376287,18375654,18379474,18378753,18378102,18372486,18374759,18379619,18378294,18378636,18370798,18379711,18377872,18375695,18379128,18376208,18379574,18378419,18378704,18373283,18375195,18374586,18376089,18373704,18379888,18369337,18372103,18374633,18371926,18377505,18363870,18377296,18358902,18374994,18376896,18375471,18373896,18372735,18373840,18369791,18360847,18376198,18376564,18373752,18374184,18369593,18369789,18369792,18373543,18370733,18365433,18375990,18369497,18369165,18378793,18373401,18378494,18370853,18377290,18379844,18372613,18364137,18373446,18369384,18366868,18375148,18373159,18371392,18369652,18372749,18377106,18373247,18377381,18369637,18361020,18370005,18377240,18361044,18374456,18356858,18369822,18375998,18370208,18364218,18373240,18369048,18371474,18372774,18373737,18376964,18361299,18376625,18352769,18373354,18370327,18370749,18377216,18376787,18367381,18374125,18370463,18367841,18373488,18369515,18373124,18363374,18356659,18372276,18364269,18369092,18367399,18366767,18360792,18361665,18363668,18372485,18377580,18370130,18360779,18364518,18370409,18355568,18359957,18369402,18355010,18365851,18377373,18369788,18370498,18363750,18377313,18363974,18367680,18365131,18360766,18359034,18377196,18353008,18353047,18361224,18358268,18363760,18357550,18356645,18364866,18365532,18356821,18370446,18361006,18371930,18374692,18367717,18370309,18372399,18369330,18361726,18366011,18360071,18355589,18353804,18365159,18355345,18361071,18356179,18355546,18362355,18366318,18360627,18368622,18362812,18359839,18360304,18361614,18377105,18375134,18374915,18370904,18356196,18365981,18373050,18357093,18364148,18367378,18363953,18373600,18353123,18361631,18363538,18362671,18371190,18357643,18356685,18376657,18358822,18359620,18370159,18366385,18360445,18356032,18376486,18362249,18358581,18364825,18359603,18369110,18363522,18375504,18352275,18367915,18353425,18362905,18365483,18371561,18370116,18355996,18352575,18362951,18353005,18366987,18352490,18359374,18374732,18355547,18352529,18372721,18355680,18354934,18357190,18359123,18362810,18375808,18357632,18353167,18364774,18354839,18361018,18365645,18363024,18365497,18359512,18355575,18357229,18352754,18375305,18366592,18365637,18363427,18362493,18375256,18358126,18354066,18367430,18352577,18366063,18367191,18372132,18369172,18366623,18369025,18360892,18353874,18353816,18360464,18367228,18365594,18360372,18372003,18364249,18372922,18362834,18374701,18358272,18373603,18372531,18366321,18360758,18373308,18367290,18368055,18355421,18370228,18353941,18356199,18366015,18364127,18368076,18357101,18358201,18374120,18358042,18361398,18363594,18373250,18362152,18356541,18359979,18361014,18358757,18369415,18363180,18362663,18359066,18352669,18354598,18361542,18363637,18356783,18364872,18367640,18369271,18376445,18358977,18372291,18357982,18354025,18366446,18363561,18355470,18371975,18356970,18367780,18358754,18365193,18369511,18355976,18360006,18357525,18371287,18369368,18357290,18358824,18356137,18355916,18357916,18367861,18359491,18365354,18364546,18358314,18369869,18363070,18369857,18369802,18368287,18358785,18365499,18359885,18359805,18354454,18359706,18364608,18364576,18360243,18355061,18363474,18357487,18367152,18361574,18367038,18367032,18353697,18366892,18369059,18355629,18368853,18358323,18373503,18368599,18368585,18368526,18369270,18356141,18369932,18355463,18355403,18363649,18368199,18363132,18362873,18363691,18366541,18356944,18360725,18354280,18354061,18367667,18361129,18365304,18352397,18360673,18364368,18363597,18354215,18362772,18362659,18364077,18358958,18364672,18357409,18356811,18361344,18355504,18354505,18354063,18354460,18352506,18352515,18379275,18358644,18357908,18362056,18357174,18355151,18354609,18361152,18363784,18356809,18354504,18363985,18356279,18353249,18354503,18364464,18353184,18372288,18353231,18373333,18361068,18362303,18363754,18356041,18357523,18354980,18356295,18355481,18378163,18376161]';
    
    expect(parseTopStories(jsonString).first,18378332);
    
  });
  test("parses item.json", (){
    const String jsonString = '{"by":"dhouston","descendants":71,"id":8863,"kids":[9224,8952,8917,8884,8887,8869,8940,8908,8958,9005,8873,9671,9067,9055,8865,8881,8872,8955,10403,8903,8928,9125,8998,8901,8902,8907,8894,8870,8878,8980,8934,8943,8876],"score":104,"time":1175714200,"title":"My YC app: Dropbox - Throw away your USB drive","type":"story","url":"http://www.getdropbox.com/u/2/screencast.html"}';

    expect(parseArticle(jsonString).by,"dhouston");

  });
  test("parses beststories.json over the network", () async {

    final url = 'https://hacker-news.firebaseio.com/v0/beststories.json';
    final res = await http.get(url);
    final _lstOfIds = parseTopStories(res.body);
    if(_lstOfIds.isNotEmpty){
      final storyUrl = "https://hacker-news.firebaseio.com/v0/item/${_lstOfIds.first}.json";
      final storyRes = await http.get(storyUrl);

      expect(parseArticle(storyRes.body).by,'InclinedPlane');
    }

  });
}